groups:
  - name: error-log-alerting
    rules:
      - alert: ErrorLogAlerting
        expr: |
          sum(count_over_time({host=~".+"} |~ "(?i)(error|warn|exception)" [1m])) by (container_name) > 0
        annotations:
            title: "Error logged in {{ $labels.container_name }}"
            description: "A log message with the content 'error' or 'exception' has been found. Please investigate."
        labels:
            severity: warning
  - name: rate-alerting
    rules:
    - alert: HighLogRate
      expr: |
           count_over_time(({host=~".+"})[1m]) >=0
      for: 1m            
  - name: error-log
    rules:
      - alert: ErrorLog
        expr: | 
             count_over_time({host=~".+"}[1m] | = "ERROR"  
        for: 1m      
  - name: NumberOfErrors
    rules:
    - alert: logs_error_count
      expr: rate({host=~".+"} |~ "[Ee]rror"[1m]) > 5
      for: 1m
      labels:
        severity: P4
        Source: Loki        